<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üí∏ My Money Tracker</title>

<style>
  body { font-family: system-ui,sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:1rem; }
  h1 { text-align:center; margin-bottom:1rem; }
  .card { background:#1e293b; padding:1rem; margin-bottom:1rem; border-radius:14px; }
  input, select, button { width:100%; margin-top:.6rem; padding:.75rem; border-radius:10px; border:none; font-size:1rem; }
  input, select { background:#020617; color:#e5e7eb; }
  button { background:#22c55e; color:#022c22; font-weight:bold; cursor:pointer; }
  button:active { transform:scale(0.98); }
  ul { list-style:none; padding:0; margin:0; }
  li { padding:.5rem 0; border-bottom:1px solid #334155; display:flex; justify-content:space-between; align-items:center; }
  .btn-small { background:#f87171; color:#fff; font-size:.8rem; margin-left:.5rem; border-radius:6px; padding:.3rem .5rem; cursor:pointer; }
  .section { display:none; }
  .section.active { display:block; }
  #graphCanvas { width:100%; height:220px; background:#020617; border-radius:10px; }
  #lockOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15,23,42,.95); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10; }
  #lockOverlay input { width:60%; margin-bottom:1rem; }
</style>
</head>

<body>

<h1>üí∏ My Money Tracker</h1>

<!-- Navigation -->
<div class="card">
  <button onclick="showSection('main')">Home</button>
  <button onclick="showSection('graphs')">Graphs</button>
  <button onclick="showSection('backup')">Backup</button>
</div>

<!-- MAIN SECTION -->
<div id="main" class="section active">

  <div class="card">
    <div style="display:flex; justify-content:space-between;">
      <div><strong>Today</strong><br><span id="today">$0</span></div>
      <div><strong>This Month</strong><br><span id="month">$0</span></div>
    </div>
  </div>

  <div class="card">
    <input id="amount" type="number" placeholder="Amount ($)" inputmode="decimal">
    <select id="category">
      <option>Food</option>
      <option>Transport</option>
      <option>Bills</option>
      <option>Shopping</option>
      <option>Fun</option>
      <option>Other</option>
    </select>
    <input id="note" placeholder="Note (optional)">
    <button onclick="addExpense()">Add Expense</button>
  </div>

  <div class="card">
    <h3>History</h3>
    <ul id="history"></ul>
    <div id="empty" style="text-align:center; color:#94a3b8; font-size:.9rem; padding:.5rem;">No expenses yet</div>
  </div>

</div>

<!-- GRAPHS SECTION -->
<div id="graphs" class="section">
  <div class="card">
    <h3>Last 7 Days Expenses by Category</h3>
    <canvas id="graphCanvas"></canvas>
  </div>
</div>

<!-- BACKUP SECTION -->
<div id="backup" class="section">
  <div class="card">
    <button onclick="exportData()">Export Backup</button>
    <input type="file" id="importFile" style="margin-top:.5rem;">
    <button onclick="importData()">Import Backup</button>
  </div>
</div>

<!-- LOCK OVERLAY -->
<div id="lockOverlay" style="display:none;">
  <h2>Enter PIN</h2>
  <input id="pinInput" type="password" placeholder="4-digit PIN">
  <button onclick="checkPIN()">Unlock</button>
</div>

<script>
/* ------------------ SETTINGS ------------------ */
const STORAGE_KEY = "my_money_data_usd";
const PIN_KEY = "my_money_pin";
const DAILY_LIMIT = 50; // example daily limit in $

/* ------------------ SECTIONS ------------------ */
function showSection(id) {
  ['main','graphs','backup'].forEach(s=>{
    document.getElementById(s).classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
  if(id==='graphs') drawGraph();
}

/* ------------------ DATA FUNCTIONS ------------------ */
function loadData(){ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
function saveData(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

/* ------------------ ADD / DELETE / EDIT ------------------ */
function addExpense(){
  const amt = Number(document.getElementById("amount").value);
  if(!amt||amt<=0) return;
  const expense={id:Date.now(), amount:amt, category:document.getElementById("category").value, note:document.getElementById("note").value.trim(), date:new Date().toISOString().slice(0,10)};
  const data = loadData();
  data.unshift(expense);
  saveData(data);
  document.getElementById("amount").value="";
  document.getElementById("note").value="";
  render();
}

function deleteExpense(id){
  let data = loadData();
  data = data.filter(e=>e.id!==id);
  saveData(data);
  render();
}

function editExpense(id){
  let data = loadData();
  const item = data.find(e=>e.id===id);
  const newAmount = prompt("Edit Amount:", item.amount);
  if(newAmount===null) return;
  const newCat = prompt("Edit Category:", item.category);
  if(newCat===null) return;
  const newNote = prompt("Edit Note:", item.note);
  if(newNote===null) return;
  item.amount = Number(newAmount);
  item.category = newCat;
  item.note = newNote;
  saveData(data);
  render();
}

/* ------------------ RENDER ------------------ */
function render(){
  const data = loadData();
  const todayStr = new Date().toISOString().slice(0,10);
  const monthStr = todayStr.slice(0,7);
  let todayTotal=0, monthTotal=0;

  const history = document.getElementById("history");
  const empty = document.getElementById("empty");
  history.innerHTML="";

  if(data.length===0){ empty.style.display="block"; } else { empty.style.display="none"; }

  data.forEach(item=>{
    if(item.date===todayStr) todayTotal+=item.amount;
    if(item.date.startsWith(monthStr)) monthTotal+=item.amount;

    const li = document.createElement("li");
    li.innerHTML = `${item.date} ‚Ä¢ $${item.amount} ‚Ä¢ ${item.category} 
      <span>
        <button class="btn-small" onclick="editExpense(${item.id})">‚úèÔ∏è</button>
        <button class="btn-small" onclick="deleteExpense(${item.id})">üóë</button>
      </span>`;
    history.appendChild(li);
  });

  const todayElem=document.getElementById("today");
  todayElem.textContent=`$${todayTotal.toFixed(2)}`;
  todayElem.style.color = todayTotal>DAILY_LIMIT?'red':'#e5e7eb';
  document.getElementById("month").textContent=`$${monthTotal.toFixed(2)}`;
}

/* ------------------ BACKUP ------------------ */
function exportData(){
  const data = localStorage.getItem(STORAGE_KEY);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='money_backup.json'; a.click();
  URL.revokeObjectURL(url);
}

function importData(){
  const fileInput = document.getElementById("importFile");
  if(fileInput.files.length===0) return alert("Select a JSON file first.");
  const reader = new FileReader();
  reader.onload = function(e){
    try{
      const imported = JSON.parse(e.target.result);
      if(!Array.isArray(imported)) throw 'Invalid format';
      localStorage.setItem(STORAGE_KEY, JSON.stringify(imported));
      render();
      alert("Backup imported!");
    }catch(err){ alert("Invalid file."); }
  };
  reader.readAsText(fileInput.files[0]);
}

/* ------------------ GRAPH ------------------ */
function drawGraph(){
  const canvas = document.getElementById("graphCanvas");
  const ctx = canvas.getContext("2d");
  canvas.height = 220;
  canvas.width = canvas.offsetWidth;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const data = loadData();
  const labels = [];
  const categories = ["Food","Transport","Bills","Shopping","Fun","Other"];
  const colors = { "Food":"#f87171","Transport":"#60a5fa","Bills":"#facc15","Shopping":"#a78bfa","Fun":"#34d399","Other":"#fbbf24" };

  const dailyValues = [];
  for(let i=6;i>=0;i--){
    const d=new Date(); d.setDate(d.getDate()-i);
    const str=d.toISOString().slice(0,10);
    labels.push(str.slice(5));
    const catTotals={}; categories.forEach(c=>catTotals[c]=0);
    data.forEach(e=>{ if(e.date===str) catTotals[e.category]+=e.amount; });
    dailyValues.push(catTotals);
  }

  const maxVal = Math.max(...dailyValues.map(dv => categories.reduce((sum,c)=>sum+dv[c],0)),10);
  const padding = 30;
  const barWidth = (canvas.width-padding*2)/labels.length -10;

  // Y-axis grid
  ctx.strokeStyle="#334155"; ctx.lineWidth=1; ctx.beginPath();
  for(let i=0;i<=5;i++){
    const y=canvas.height-padding-(i/5)*(canvas.height-padding*2);
    ctx.moveTo(padding,y); ctx.lineTo(canvas.width-padding,y);
  }
  ctx.stroke();

  // Draw stacked bars
  dailyValues.forEach((day,i)=>{
    let x=padding+i*(barWidth+10); let y=canvas.height-padding;
    categories.forEach(cat=>{
      const val=day[cat];
      const barHeight=(val/maxVal)*(canvas.height-padding*2);
      if(val>0){ ctx.fillStyle=colors[cat]; ctx.fillRect(x,y-barHeight,barWidth,barHeight); y-=barHeight; }
    });
    // Day label
    ctx.fillStyle="#e5e7eb"; ctx.font="12px sans-serif"; ctx.fillText(labels[i], x, canvas.height-10);
  });

  // Legend
  let lx=padding, ly=10;
  categories.forEach(cat=>{
    ctx.fillStyle=colors[cat]; ctx.fillRect(lx,ly,12,12);
    ctx.fillStyle="#e5e7eb"; ctx.fillText(cat,lx+16,ly+12);
    lx+=70;
  });
}

/* ------------------ APP LOCK ------------------ */
function checkPIN(){
  const input=document.getElementById("pinInput").value;
  const stored=localStorage.getItem(PIN_KEY);
  if(!stored){
    if(input.length===4){ localStorage.setItem(PIN_KEY,input); hideLock(); alert("PIN set!"); }
    else alert("Enter 4-digit PIN to set.");
  }else{
    if(input===stored) hideLock(); else alert("Incorrect PIN");
  }
}
function hideLock(){ document.getElementById("lockOverlay").style.display="none"; }
if(localStorage.getItem(PIN_KEY)){ document.getElementById("lockOverlay").style.display="flex"; }

/* ------------------ INITIAL RENDER ------------------ */
render();
</script>
</body>
</html>
